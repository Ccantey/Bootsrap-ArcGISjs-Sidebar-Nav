<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <link rel="shortcut icon" href="../../assets/ico/favicon.ico">

    <title>GIS | Wisc Rapids</title>

    <!-- Bootstrap core CSS -->
    <link href="css/bootstrap.css" rel="stylesheet">
	<!--JavaScript API & Stylesheets-->
	<script src="http://js.arcgis.com/3.9/"></script>
    <link href="http://js.arcgis.com/3.9/js/esri/css/esri.css" rel="stylesheet">
    <!-- Custom styles for this template -->
    <link href="css/dashboard.css" rel="stylesheet">

    <!-- Just for debugging purposes. Don't actually copy this line! -->
    <!--[if lt IE 9]><script src="../../assets/js/ie8-responsive-file-warning.js"></script><![endif]-->

    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/libs/html5shiv/3.7.0/html5shiv.js"></script>
      <script src="https://oss.maxcdn.com/libs/respond.js/1.4.2/respond.min.js"></script>
    <![endif]-->
	
	<script>	
	  var initExtent;
	  var basemap, utilityMap, maxExtent;
	  var overlayLayer;
	  var aerialLayer;
	  var nonLegendLayers;
	  var legend = null;
	  var legendLayers = [];
      var map = null;
	  var globalMapLayers = [];
	  var geocoder;
		
		require(["dojo/on", 
			  "esri/domUtils",
			  "esri/map",
			  "esri/request",		
			  "esri/dijit/Legend",
			  "esri/layers/ArcGISDynamicMapServiceLayer",	
			  "esri/dijit/Geocoder"			  ,
			  "esri/geometry/Extent",
			  "esri/SpatialReference",
			  "dojo/domReady!"],
		function(on, domUtils, Map, esriRequest, Legend, ArcGISDynamicMapServiceLayer, Geocoder, Extent, SpatialReference){	
		
		  var mapServiceURL = "https://gis.wirapids.org/arcgis/rest/services/DynamicBasemap/MapServer";
		  
		  //initExtent = new Extent({xmin:-1.0016607077900654E7,ymin:5514621.059962168,xmax:-9982809.986253398,ymax:5538802.983481816,spatialReference:{wkid:102100}})
		  map = new Map("map", {
			center: [-89.83, 44.39],
			zoom: 14,
			basemap:'hybrid'
			
		  }); 
		var layersRequest = esriRequest({
			url: mapServiceURL,
			content: { f: "json" },
			handleAs: "json",
			callbackParamName: "callback"
		  });
		  layersRequest.then(
			function(response) {
			  //console.log("Success: ", response.layers);
			  globalMapLayers = response.layers;
		  }, function(error) {
			  console.log("Error: ", error.message);
		  });		    
		 
		  
		  //Add dynamic map 
		  overlayLayer = new ArcGISDynamicMapServiceLayer(mapServiceURL, {id:"Basemap"});
		  overlayLayer.setImageFormat("png32");
		  overlayLayer.setVisibleLayers([-1]);
		  //overlayLayer.opacity = 0.7;
		  map.addLayer(overlayLayer);
          //console.log(overlayLayer);

		  //create geocoder
		  geocoder = new Geocoder({
		     autoComplete: true,
			 maxLocations: 10,
			 suffix: " Wisconsin Rapids, WI",
		     map:map
		  }, "search");
		  geocoder.startup();
		  
          //legendLayers.push({ layer: map, title: " ",hideLayers:[0,1,2,3,27]});
	      legendLayers.push({ layer: overlayLayer, title: "Legend ",hideLayers:[0,1,2,3,27]});
		  console.log(legendLayers);
		  legend = new Legend({
            map:map,
            layerInfos:legendLayers
          },"legendDiv");
		  legend.startup();

  
		   
	  });
	</script>
  </head>

  <body>

    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="offcanvas" data-target=".sidebar-nav">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">Wisconsin Rapids</a>
        </div>
		<!--search-->
        <div class="navbar-collapse collapse">
           <ul class="nav navbar-nav navbar-right" id="about">
            <li><a href="#">about</a></li>
 <!--            <li><a href="#">Settings</a></li>
            <li><a href="#">Profile</a></li> -->
            <li><a href="#">Help</a></li>
          </ul> 
          <form class="navbar-form navbar-right">
            <div id ="search"></div>
          </form>
        </div>
		
      </div>
    </div>

    <div class="container-fluid">
      <div class="row row-offcanvas row-offcanvas-left">
	   <!--sidebar-->
        <div class="col-xs-6 col-sm-3 sidebar-offcanvas" id="sidebar" role="navigation">
          <ul class="nav">
            <li class="overlayLayer"><a href="#">Garbage Pickup</a></li>
            <li class="overlayLayer"><a href="#">Sanitary_Manholes</a></li>
            <li class="overlayLayer"><a href="#">Sanitary_Pipe</a></li>
			<li class="overlayLayer"><a href="#">Construction</a></li>
            <li class="overlayLayer"><a href="#">Trails & Parks</a></li>
            <li class="overlayLayer"><a href="#">Zoning</a></li>
          </ul>

		  
		  <!--add legend here-->
		  <section class="legend-items" id="legendDiv">

           </section>
		  <!--footer-->
		  <img class="foot" src="images/watermark2.png" alt="Rapids Logo">
        </div>
        <div id="map">

        </div>
      </div>
    </div>



    <!-- Bootstrap core JavaScript
    ================================================== -->
    <!-- Placed at the end of the document so the pages load faster -->
	
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/1.11.0/jquery.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
	<script src="js/app.js"></script>
  </body>
</html>
